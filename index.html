<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vitaminca Visit Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; margin: 1rem; }
    label { display: block; margin-top: 0.8rem; font-weight: 600; }
    input, select, textarea { width: 100%; padding: 0.4rem; font-size: 1rem; }
    button { margin-top: 1rem; padding: 0.6rem 1rem; font-size: 1rem; }
    .hidden { display:none; }
    .success { color: green; margin-top: 1rem; }
    .error { color: red; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>AQUADOSE Visit Report</h2>
  <form id="visitForm">
    <label for="repName">Full Name</label>
    <select id="repName" required>
      <option value="Sharique">Sharique</option>
    </select>

    <label for="visitType">Visit Type</label>
    <select id="visitType" required>
      <option value="">--Select--</option>
      <option value="Doctor">Doctor</option>
      <option value="Pharmacy">Pharmacy</option>
      <option value="Drug Store">Drug Store</option>
    </select>

    <label for="personName">Doctor/Pharmacist/Person Name</label>
    <input type="text" id="personName" required>

    <label for="accountName">Account Name (Hospital/Clinic/Pharmacy/Drug Store)</label>
    <input type="text" id="accountName" required>

    <label for="contactNumber">Contact Number (Mobile)</label>
    <input type="tel" id="contactNumber" pattern="[0-9+ ]+" required>

    <label for="specialty">Specialty</label>
    <select id="specialty" required>
      <option value="">--Select--</option>
      <option value="GP">GP</option>
      <option value="FAMILY MEDICINE">FAMILY MEDICINE</option>
      <option value="PEDIATRICS">PEDIATRICS</option>
      <option value="PHARMACIST">PHARMACIST</option>
      <option value="Others">Others</option>
    </select>

    <div id="doctorFields" class="hidden">
      <label for="prescribingStatus">Prescribing Status</label>
      <select id="prescribingStatus">
        <option value="">--Select--</option>
        <option value="Prescribed">Prescribed</option>
        <option value="Considering">Considering</option>
        <option value="Refused">Refused</option>
        <option value="Already Prescribing">Already Prescribing</option>
      </select>
    </div>

    <div id="pharmacyFields" class="hidden">
      <label for="pharmacyStock">Pharmacy Stock</label>
      <input type="text" id="pharmacyStock">

      <label for="movementLevel">Movement Level</label>
      <select id="movementLevel">
        <option value="">--Select--</option>
        <option value="Fast">Fast</option>
        <option value="Medium">Medium</option>
        <option value="Slow">Slow</option>
      </select>
    </div>

    <input type="hidden" id="latitude">
    <input type="hidden" id="longitude">

    <button type="submit">Submit Visit</button>
  </form>

  <div id="status" class=""></div>

<script>
  const visitTypeEl = document.getElementById('visitType');
  const doctorFields = document.getElementById('doctorFields');
  const pharmacyFields = document.getElementById('pharmacyFields');
  const statusEl = document.getElementById('status');

  visitTypeEl.addEventListener('change', () => {
    const type = visitTypeEl.value;
    doctorFields.classList.toggle('hidden', type !== 'Doctor');
    pharmacyFields.classList.toggle('hidden', type !== 'Pharmacy');
  });

  const scriptURL = 'https://script.google.com/macros/s/AKfycbz7n-H5JX4oiG4BreAeFDdsYXmRG8k0ouXCbElmMilj9eMVDFU9EH_e67tq4_sY69A8bw/exec';

  function getLocation() {
    if (!navigator.geolocation) {
      alert('Geolocation not supported');
      return;
    }
    navigator.geolocation.getCurrentPosition((pos) => {
      document.getElementById('latitude').value = pos.coords.latitude;
      document.getElementById('longitude').value = pos.coords.longitude;
    }, (err) => {
      console.error(err);
      alert('Location permission denied.');
    }, { enableHighAccuracy: true });
  }

  window.onload = getLocation;

  document.getElementById('visitForm').addEventListener('submit', (e) => {
    e.preventDefault();
    statusEl.textContent = 'Submitting...';
    const data = {
      repName: document.getElementById('repName').value,
      visitType: visitTypeEl.value,
      personName: document.getElementById('personName').value,
      accountName: document.getElementById('accountName').value,
      contactNumber: document.getElementById('contactNumber').value,
      specialty: document.getElementById('specialty').value,
      prescribingStatus: document.getElementById('prescribingStatus').value,
      pharmacyStock: document.getElementById('pharmacyStock').value,
      movementLevel: document.getElementById('movementLevel').value,
      latitude: document.getElementById('latitude').value,
      longitude: document.getElementById('longitude').value
    };
    fetch(scriptURL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    }).then(() => {
      statusEl.textContent = '✅ Visit recorded successfully!';
      statusEl.className = 'success';
      document.getElementById('visitForm').reset();
      getLocation();
    }).catch(err => {
      console.error(err);
      statusEl.textContent = '❌ Error submitting visit.';
      statusEl.className = 'error';
    });
  });

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }
</script>
</body>
</html>
